# Housing in the PlanRVA Region {#part-4-1}

```{r}
#| label: setup

# Load necessary packages.

library(tidycensus)
library(tidyverse)
library(hdatools)
library(ggiraph)
library(scales)
library(patchwork)
library(ggtext)
library(kableExtra)
library(leaflet)
library(zoo)

```

Richmond Magazine's ["It Takes More Than A Village"](https://richmondmagazine.com/news/features/it-takes-more-than-a-village/) article recently highlighted the challenges the Richmond regional housing market continues to face. Housing costs - both for rental and homeownership - are up significantly from where they were over a decade ago and the abundant supply has dwindled to a trickle.

The Census Building Permit Survey from 2000 to 2022 shows that single-family construction starts have been on the way to recovery since the Great Recession.[^part-4-1-1] But they still pale in comparison to pre-Recession numbers. The market shift to multifamily in the past few years speaks to not only growing preferences among households, but also the challenges residents face in accessing the homeownership market (e.g., interest rates, increasing debt, competition with cash buyers, etc.).

[^part-4-1-1]: Adam Pagnucco, a writer on state and local politics, has written about the potential pitfalls of Census Building Permit Survey in accurately accounting for building starts in his piece [This Mess Must Be Fixed](https://montgomeryperspective.com/2023/06/29/this-mess-must-be-fixed/). To that end, it must be noted that BPS relies on localities to voluntarily submit accurate data to the Census Bureau. Estimates shown may not be completely accurate depending on the locality and their participation in the survey. In lieu of data directly from the locality, BPS often serves as the sole source of this information.

The region, not unlike others in the Commonwealth, is very much lacking in the construction of smaller two to four unit buildings, so often seen in the historic neighborhoods of Richmond. This "Missing Middle" is literally missing in the market.

```{r}
#| label: fig-bps
#| fig-cap: "Total new residential building permits issued from 2000 to 2023"

# Create a visualization that shows where housing is being built. Where is more diverse housing being built? Where is single-family housing being built the most? How does that compare to population growth in those localities?

bps <- read_rds("data/planrva/rds/rva_bps.rds") |> # Load in Building Permits Survey data.
  mutate(type = case_when( # Group "Missing Middle" housing together.
    type == "2-units" ~ "2-4 units",
    type == "3-4 units" ~ "2-4 units",
    TRUE ~ type
  )) |> 
  group_by(name_long, year, type) |> # Aggregate to locality and housing type.
  summarise(units = sum(units)) |> 
  group_by(name_long) |> # Group by locality.
  mutate(total = sum(units)) # Calculate the total number of new permits for entire time period.


# Summarize the percentage of units developed by type for the narrative.

bps_summary <- bps |> 
  group_by(type) |> # Aggregate by housing type.
  summarise(units = sum(units)) |> 
  mutate(pct = units/sum(units)) # Calculate the percentage of type of units for the region.


subtitle_text <- "Few <span style = 'color:#40C0C0'><b>2-4 unit housing</span> has been built between 2000 to 2023"
  
bps_plot <- ggplot(bps,
       aes(x = year,
           y = units,
           fill = type,
           data_id = units,
           tooltip = number_format(big.mark =",")(units))) + 
  geom_col_interactive(position = "stack", width = 0.8) +
  facet_wrap(~type) +
  theme_hfv(base_size = 10) + 
  scale_fill_hfv() +
  scale_y_continuous(labels = number_format(big.mark = ",", style_positive = "plus")) +
  labs(title = "Total new residential building permits issued in the PlanRVA region",
       subtitle = subtitle_text,
       caption = "**Source:** U.S. Census Bureau. Building Permits Survey.") + 
  theme(panel.grid.major.y = element_line(color = "white"),
        panel.grid.major.x = element_line(color = "#f5f5f5",size = 0.1),
        axis.text.x = element_text(angle = 90)) +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    )))

# girafe(ggobj = bps_plot,
#        height_svg = 4)

bps_plot

```

Single-family construction starts (which includes single-family attached housing) are high in the largest counties in the region, where greenfield development opportunities are numerous. Infill development opportunities in the City of Richmond limit the ability for substantial new supply of homeownership, but opportunities still exist for resale and redevelopment.

```{r}
#| label: fig-bps-1
#| fig-cap: "Total new single-family residential building permits issued from 2000 to 2023"

# Create a visualization that shows where 2+ housing is being built. Where is more diverse housing being built? 

density <- c("Hanover", "Henrico", "Chesterfield", "Richmond")

bps <- read_rds("data/planrva/rds/rva_bps.rds") |> # Load in Building Permits Survey data.
  mutate(type = case_when( # Group "Missing Middle" housing together.
    type == "2-units" ~ "2-4 units",
    type == "3-4 units" ~ "2-4 units",
    TRUE ~ type
  )) |> 
  group_by(name_long, year, type) |> # Aggregate to locality and housing type.
  summarise(units = sum(units)) |> 
  group_by(name_long) |> # Group by locality.
  mutate(total = sum(units)) |> # Calculate the total number of new permits for entire time period.
  filter(type == "1-unit") 


# subtitle_text <- "Few <span style = 'color:#40C0C0'><b>2-4 unit housing</span> has been built between 2000 to 2023"
  
bps_plot <- ggplot(bps,
       aes(x = reorder(name_long, units),
           y = units,
           fill = type,
           data_id = units,
           tooltip = number_format(big.mark =",")(units))) + 
  geom_col_interactive(position = "stack") +
  theme_hfv(base_size = 10) + 
  scale_fill_hfv() +
  scale_y_continuous(labels = number_format(big.mark = ",", style_positive = "plus")) +
  labs(title = "Total new 1-unit residential building permits issued in the PlanRVA region",
       caption = "**Source:** U.S. Census Bureau. Building Permits Survey.") + 
  theme(panel.grid.major.y = element_line(color = "white"),
        panel.grid.major.x = element_line(color = "#f5f5f5",size = 0.1),
        axis.text.x = element_text(angle = 90)) +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    )))

# girafe(ggobj = bps_plot,
#        height_svg = 4)

bps_plot

```

Observing variations across jurisdictions, it may surprise many that Chesterfield County exceeds the City of Richmond in 2-4 unit and 5 or more unit construction starts. Henrico County also exceeds Richmond in terms of the number of 2-4 unit residential buildings. As noted previously in a footnote, building permit data from the Census Bureau should be taken with caution. But generally, the region continues to underbuild in the face of a rising population. The [University of Virginia's Weldon Cooper Center](https://www.coopercenter.org/) noted that between 2020 and 2023, the Richmond region saw the greatest increase in new residents (+40,000). The relative affordability of the region compared to other major metros along the Mid-Atlantic and the continued proliferation of remote work opportunities has continued to bring residents --- often with higher incomes --- to the region. 

```{r}
#| label: fig-bps-2
#| fig-cap: "Total new 2+ residential building permits issued from 2000 to 2023"

# Create a visualization that shows where 2+ housing is being built. Where is more diverse housing being built? 

density <- c("Hanover", "Henrico", "Chesterfield", "Richmond", "Goochland")

bps <- read_rds("data/planrva/rds/rva_bps.rds") |> # Load in Building Permits Survey data.
  mutate(type = case_when( # Group "Missing Middle" housing together.
    type == "2-units" ~ "2-4 units",
    type == "3-4 units" ~ "2-4 units",
    TRUE ~ type
  )) |> 
  group_by(name_long, year, type) |> # Aggregate to locality and housing type.
  summarise(units = sum(units)) |> 
  group_by(name_long) |> # Group by locality.
  mutate(total = sum(units)) |> # Calculate the total number of new permits for entire time period.
  filter(type != "1-unit") |> 
  filter(name_long %in% density) |> 
  filter(name_long != "Goochland")


subtitle_text <- "Few <span style = 'color:#40C0C0'><b>2-4 unit housing</span> has been built between 2000 to 2023"
  
bps_plot <- ggplot(bps,
       aes(x = reorder(name_long, units),
           y = units,
           fill = type,
           data_id = units,
           tooltip = number_format(big.mark =",")(units))) + 
  geom_col_interactive(position = "stack") +
  facet_wrap(~type) +
  theme_hfv(base_size = 10) + 
  scale_fill_hfv() +
  scale_y_continuous(labels = number_format(big.mark = ",", style_positive = "plus")) +
  labs(title = "Total new residential building permits issued in the PlanRVA region",
       subtitle = subtitle_text,
       caption = "**Source:** U.S. Census Bureau. Building Permits Survey.") + 
  theme(panel.grid.major.y = element_line(color = "white"),
        panel.grid.major.x = element_line(color = "#f5f5f5",size = 0.1),
        axis.text.x = element_text(angle = 90)) +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    )))

# girafe(ggobj = bps_plot,
#        height_svg = 4)

bps_plot

```


```{r}
#| label: fig-pct-homeowner
#| fig-cap: "Homeownership in the PlanRVA region"
#| eval: false

tenure <- read_rds("data/planrva/rds/b25003.rds") |>
  group_by(year, NAME, tenure) |> 
  summarise(estimate = sum(estimate)) |> 
  ungroup() |> 
  group_by(year, NAME) |> 
  mutate(total = sum(estimate)) |> 
  mutate(pct = estimate/total) |> 
  filter(tenure == "Homeowner") |> 
  filter(year == 2010 | year == 2022) |> 
  mutate(year = as.character(year)) 


subtitle_text <- "In <span style = 'color:#011E41'><b>2010</b></span> and <span style = 'color:#40C0C0'><b>2022</span>"

# tenure_plot <- 
  
ggplot(tenure,
       aes(x = reorder(NAME, pct),
           y = pct,
           color = year)) +
  geom_line(size = 1, color = "grey") +
  geom_point_interactive(aes(color = year,
                             data_id = pct,
                             tooltip = percent_format(accuracy = 1)(pct)), 
                         size = 2) +
  coord_flip() +
  theme_hfv() +
  scale_y_continuous(labels = percent_format(), limits = c(.35, 1)) +
  labs(title = "Homeownership rate in the PlanRVA region",
       subtitle = subtitle_text,
       caption = "**Source:** U.S. Census Bureau, ACS, 5-Year Estimates, Table B25003.") +
  scale_color_hfv() +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    ))) + 
  theme(panel.grid.major.y = element_line(color = "white"),
        panel.grid.major.x = element_line(color = "#dadada",size = 0.1))

#   
# girafe(ggobj = tenure_plot,
#        height_svg = 4)

```

The demand from new residents and the undersupply of housing has contributed to significant price increases in recent years. The median home sales price in the Richmond Metropolitan Area has reached \$400,000 as of the second quarter of 2024. This is a far cry from 2014 when the median price was under \$200,000. And while it is important to note that the value of the dollar has changed over time, everyday people interpret home prices based on their experience at the time. For that reason, we present the median home sales price in nominal dollars (i.e. what the price was at that time) and real dollars (i.e., what the price is in current dollars).

```{r}
#| label: fig-rva-price
#| fig-cap: "Median home sales price in Richmond MSA"

# What have home prices been like?


rva_var_price <- read_rds("data/planrva/rds/rva_var.rds") |> 
  select(geography, period, name, med_price, adj_price) |> 
  pivot_longer(4:5,
               names_to = "type",
               values_to = "price") |> 
  mutate(type = case_when(
    type == "adj_price" ~ "Adjusted Price",
    type == "med_price" ~ "Nominal Price"
  )) |> 
  # filter(type == "Nominal Price") |> 
  filter(name == "Richmond MSA") 

subtitle_text <- "In <span style = 'color:#011E41'><b>real dollars</b></span> and <span style = 'color:#40C0C0'><b>nominal dollars</span>"

var_plot <- ggplot(rva_var_price,
       aes(x = period,
           y = price,
           color = type,
           linetype = type)) +
  geom_line() +
  geom_point() +
  theme_hfv(base_size = 10) +
  scale_color_hfv() +
  scale_y_continuous(labels = dollar_format()) +
  # theme(legend.position = "top") +
  labs(subtitle = subtitle_text,
       title = "Median home price in the Richmond region",
       caption = "**Source:** Virginia REALTORS") +
  theme(panel.grid.major.y = element_line(color = "#dadada", size = 0.1),
        panel.grid.major.x = element_line(color = "#dadada",size = 0.1))
 
girafe(ggobj = var_plot,
       height_svg = 4)

 
```

The days on market for homes has decreased across the Commonwealth as buyers compete for the little supply that exists out there. The median days on market has remained below 30 days along the I-95/I-64 corridor. In the Richmond region, the median days on market has barely risen above 10 days since the onset of the pandemic and is on par with the competition and demand seen in the DC Metro Area.

```{r}
#| label: fig-rva-dom
#| fig-cap: "Median days on market in the Urban Crescent"

# How to add arrows indicating direction on line segments??
subtitle_text <- "In the <span style = 'color:#011E41'><b>Richmond MSA</b></span>, <span style = 'color:#40C0C0'><b>VB-Norfolk-NN MSA</span>, and <span style = 'color:#8B85CA'><b>Washington, D.C. MSA</span>"

library(patchwork)

rva_var_dom <- read_rds("data/planrva/rds/rva_var.rds") |> 
  select(geography, name, period, med_dom)  |> 
  mutate(year = substr(period, 1, 4)) |> 
  mutate(year = as.numeric(year)) |> 
  filter(geography == "MSA")

dom_plot <- ggplot(rva_var_dom,
                   aes(x = period,
                       y = med_dom, 
                       color = name, 
                       tooltip = med_dom)) +
  geom_line() +
  geom_line(data = filter(rva_var_dom, name == "Richmond MSA"), 
            aes(x = period, y = med_dom),
            linewidth = 1.2) +
  geom_point_interactive(aes(color = name,
                             data_id = med_dom,
                             tooltip = paste0(med_dom, " ", "days"),
                             group = 1)) +
  theme_hfv(base_size = 10) +
  scale_color_hfv() + 
  labs(title = "Median days on market",
       subtitle = subtitle_text,
       caption = "**Source:** Virginia REALTORS") +
  scale_y_continuous(breaks = seq(0, 70, 10))
  
girafe(ggobj = dom_plot,
       height_svg = 4)


```

With home prices continuing to rise in the region, it is no surprise that the share of renters has increased. Those increases from 2010 to 2022 were most prevalent in Henrico and Goochland. But overall, every locality other than Powhatan and New Kent have seen an increase in their share of renters. The demand for rental continues to rise in the region as homeownership becomes more and more out-of-reach even for middle-income households.

```{r}
#| label: fig-pct-renter
#| fig-cap: "Percent of renter households in the PlanRVA region"

tenure <- read_rds("data/planrva/rds/b25003.rds") |> 
  filter(year == 2010 | year == 2022) |> 
  filter(tenure == "Renter") |> 
  mutate(year = as.character(year)) |> 
  mutate(NAME = str_remove(NAME, "County"))

subtitle_text <- "In <span style = 'color:#011E41'><b>2010</b></span> and <span style = 'color:#40C0C0'><b>2022</span>"

tenure_plot <- ggplot(tenure,
       aes(x = reorder(NAME, pct),
           y = pct,
           color = year)) +
  geom_line(size = 1, color = "grey") +
  geom_point_interactive(aes(color = year,
                             data_id = pct,
                             tooltip = percent_format(accuracy = 1)(pct)), 
                         size = 2) +
  coord_flip() +
  theme_hfv() +
  scale_y_continuous(labels = percent_format()) +
  labs(title = "Percent of renter households in Hampton Roads",
       subtitle = subtitle_text,
       caption = "**Source:** U.S. Census Bureau, ACS, 5-Year Estimates, Table B25003.") +
  scale_color_hfv() +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    ))) + 
  theme(panel.grid.major.y = element_line(color = "white"),
        panel.grid.major.x = element_line(color = "#dadada",size = 0.1))

girafe(ggobj = tenure_plot,
       height_svg = 4)

```

Rents saw major nominal jumps in 2021. Increased rental demand amid COVID protections led to less unit turnover and even less available supply, leading to subsequent rent increases. Recent data from CoStar Group, Inc. estimates that the average asking rent in the region is just over \$1,400. For a household to not be rent cost-burdened, they would have to make approximately \$56,000 annually. This figure is about \$18,000 more than the median renter household income in the Richmond Metropolitan Statistical Area - \$48,171 in 2022. Based on these estimates, more than half of renters in the entire metro area could not afford rent in the Richmond region. 

```{r}
#| label: fig-rva-rent
#| fig-cap: "Average asking rent in Richmond region"


rva_rent <- read_rds("data/planrva/rds/rva_costar.rds") |> 
  select(period, rent, adj_price) |> 
  mutate(quarters = zoo::as.yearqtr(period)) |> 
  pivot_longer(2:3,
               names_to = "rent",
               values_to = "dollars")

subtitle_text <- "In <span style = 'color:#011E41'><b>Q2 2024 dollars</b></span> and <span style = 'color:#40C0C0'><b>nominal dollars</span>"

rent_plot <- ggplot(rva_rent,
       aes(x = quarters,
           y = dollars,
           color = rent,
           linetype = rent)) +
  geom_line() +
  geom_point_interactive(aes(
    data_id = dollars,
    tooltip = dollar_format()(dollars)
  )) +
  theme_hfv() +
  scale_y_continuous(labels = dollar_format()) +
  zoo::scale_x_yearqtr(breaks = seq(from = min(rva_rent$quarters), 
                               to = max(rva_rent$quarters), 
                               by = 1),format = '%Y-Q%q') +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Average asking rent in Richmond region",
       subtitle = subtitle_text,
       caption = "**Source:** CoStar Group, Inc.") +
  scale_color_hfv()  +
  plot_annotation(
    theme = theme(
    plot.subtitle = element_markdown(
       margin = margin(b = 0.4, unit = 'cm'),
        size = 11.5
    ))) + 
  theme(panel.grid.major.y = element_line(color = "#dadada", size = 0.1),
        panel.grid.major.x = element_line(color = "#dadada",size = 0.1))
  # scale_color_gradientn(colours = c("#ADDCB1", "#46A88F", "#207A88", "#0F1A4E"))

girafe(ggobj = rent_plot,
       height_svg = 4)

```

A healthy rental vacancy rate is dependent on various factors, including location and economic conditions. Generally, a rate between 5 and 10 percent is considered balanced between supply and demand. Before the pandemic, the rental vacancy rate in the region sat between 6 and 8 percent. During the pandemic, that rate dropped below 5 percent, before climbing to a record 9 percent in the last quarter of 2023. According to the Virginia REALTORS, "the rise in vacancy rates is attributed to the apartment construction boom of 2022 as builders attempted to meet the need for more housing."

While this may indicate an oversupply, lease up will continue to occur as new inventory hits the market and vacancy rates will trend down in the coming quarters. Rent growth may slow as more units are continuously added to the region, but one fact remains, the income for many renters is not keeping pace.

```{r}
#| label: fig-rva-rv
#| fig-cap: "Rental vacancy in Richmond region"

rva_rv <- read_rds("data/planrva/rds/rva_costar.rds") |> 
  select(period, vacancy_rate) |> 
  mutate(quarters = as.yearqtr(period))

vacancy_plot <- ggplot(rva_rv,
       aes(x = quarters,
           y = vacancy_rate,
           color = vacancy_rate)) +
  geom_line() +
  geom_point_interactive(aes(
    data_id = vacancy_rate,
    tooltip = percent_format(accuracy = 0.01)(vacancy_rate)
  )) +
  theme_hfv() +
  scale_y_continuous(labels = percent_format()) +
  scale_x_yearqtr(breaks = seq(from = min(rva_rv$quarters), to = max(rva_rv$quarters), by = 1),
                  format = '%Y-Q%q') +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Rental vacancy rate in Richmond region",
       caption = "**Source:** CoStar Group, Inc.") + 
  scale_color_gradientn(colours = c("#ADDCB1", "#46A88F", "#207A88", "#0F1A4E"))

girafe(ggobj = vacancy_plot,
       height_svg = 4)

```

## Conclusions

The Richmond region's for-sale market has continued to see major increases in sales prices, while rents follow albeit at a slower pace. But the fact remains that more diverse types of housing are needed in both the for-sale and rental markets. Zoning can act as an artificial limiter on the housing supply and as we will see in the next section, there are dozens of opportunities to increase supply in all parts of the region.
